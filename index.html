<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>❤️ LOVE 12A1 - Gửi lời yêu thương ❤️</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6b8b;
            --secondary-color: #ffb8c6;
            --accent-color: #ff4757;
            --text-color: #333;
            --light-text: #fff;
            --bg-gradient: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Quicksand', sans-serif;
            color: var(--text-color);
            background: var(--bg-gradient);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background 0.5s ease;
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            z-index: -1;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
        }
        
        h1, h2, h3 {
            font-family: 'Dancing Script', cursive;
            text-align: center;
            color: var(--accent-color);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }
        
        h2 {
            font-size: 2.2rem;
            margin: 2rem 0 1rem;
        }
        
        h3 {
            font-size: 1.8rem;
            margin-bottom: 2rem;
        }
        
        .wish-form {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        
        .wish-form:hover {
            transform: translateY(-5px);
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            font-family: 'Quicksand', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 139, 0.3);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        button:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 139, 0.4);
        }
        
        #submit-btn {
            width: 100%;
            font-size: 1.1rem;
        }
        
        #submit-btn i {
            margin-right: 8px;
        }
        
        .wishes-container {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        #wishes-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .wish-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            border-left: 4px solid var(--primary-color);
            transition: transform 0.3s ease;
        }
        
        .wish-card:hover {
            transform: translateY(-5px);
        }
        
        .wish-card h4 {
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }
        
        .wish-card p {
            color: var(--text-color);
            line-height: 1.6;
            white-space: pre-line;
        }
        
        .wish-card small {
            display: block;
            margin-top: 10px;
            color: #888;
            font-size: 0.8rem;
            text-align: right;
        }
        
        .wish-card .wish-type {
            display: inline-block;
            padding: 2px 8px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-bottom: 5px;
        }
        
        .wish-card::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 4rem;
            color: var(--secondary-color);
            opacity: 0.2;
            font-family: serif;
            line-height: 1;
        }
        
        .control-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .heart-float {
            position: absolute;
            font-size: 1.5rem;
            color: var(--primary-color);
            animation: float 6s ease-in-out infinite;
            opacity: 0;
            z-index: -1;
        }
        
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .confirmation-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .error-message, .loading-message, .empty-message {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-style: italic;
        }
        
        .error-message {
            color: #ff4757;
        }
        
        /* FOOTER STYLES */
        .footer {
            background: linear-gradient(135deg, rgba(255, 107, 139, 0.9) 0%, rgba(255, 71, 87, 0.9) 100%);
            backdrop-filter: blur(10px);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
            position: relative;
            overflow: hidden;
        }
        
        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><pattern id="hearts" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><text x="10" y="15" text-anchor="middle" font-size="12" fill="rgba(255,255,255,0.1)">♥</text></pattern></defs><rect width="100" height="20" fill="url(%23hearts)"/></svg>') repeat;
            opacity: 0.3;
            animation: heartMove 20s linear infinite;
        }
        
        .footer-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .footer-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .footer-description {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .footer-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .copyright {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .made-with-love {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .made-with-love .heart-icon {
            color: #ff4757;
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        .footer-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1.5rem 0;
        }
        
        .footer-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .footer-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .footer-stats {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .stats-item {
            display: inline-block;
            margin: 0 1rem;
            text-align: center;
        }
        
        .stats-number {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            font-family: 'Dancing Script', cursive;
        }
        
        .stats-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes heartbeat {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }
        
        @keyframes heartMove {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-20px);
            }
        }
        
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            h2 {
                font-size: 1.8rem;
            }
            
            h3 {
                font-size: 1.4rem;
            }
            
            #wishes-list {
                grid-template-columns: 1fr;
            }
            
            .footer-info {
                flex-direction: column;
                text-align: center;
            }
            
            .footer-links {
                flex-wrap: wrap;
            }
            
            .stats-item {
                display: block;
                margin: 0.5rem 0;
            }
            
            .footer-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="floating-hearts" id="hearts-container"></div>
    
    <div class="container">
        <h1>❤️ LOVE 12A1 ❤️</h1>
        <h3>Hãy để lại lời chúc ngọt ngào đến một ai đó...</h3>
        
        <div class="wish-form">
            <div class="form-group">
                <label for="name">Tên của bạn:</label>
                <input type="text" id="name" placeholder="Nhập tên của bạn..." required>
            </div>
            
            <div class="form-group">
                <label for="type">Loại lời chúc:</label>
                <select id="type">
                    <option value="general">Lời chúc chung</option>
                    <option value="love">Lời yêu thương</option>
                    <option value="friendship">Tình bạn</option>
                    <option value="encouragement">Động viên</option>
                    <option value="memory">Kỷ niệm</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="message">Lời chúc:</label>
                <textarea id="message" placeholder="Viết lời chúc từ trái tim của bạn ở đây..." required></textarea>
            </div>
            
            <button id="submit-btn"><i class="fas fa-heart"></i> Gửi Lời Chúc</button>
        </div>
        
        <div class="wishes-container">
            <h2>Những Lời Chúc Ngọt Ngào</h2>
            <div id="wishes-list">
                <div class="loading-message">Đang tải lời chúc...</div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-content">
            <h3 class="footer-title">❤️ LOVE 12A1 ❤️</h3>
            <p class="footer-description">
                Nơi lưu giữ những lời yêu thương, kỷ niệm đẹp và tình bạn của lớp 12A1. 
                Mỗi lời chúc là một câu chuyện, mỗi chia sẻ là một kỷ niệm đáng nhớ.
            </p>
            
            <div class="footer-stats">
                <div class="stats-item">
                    <span class="stats-number" id="total-wishes">0</span>
                    <span class="stats-label">Lời chúc</span>
                </div>
                <div class="stats-item">
                    <span class="stats-number">❤️</span>
                    <span class="stats-label">Tình yêu</span>
                </div>
                <div class="stats-item">
                    <span class="stats-number">12A1</span>
                    <span class="stats-label">Lớp học</span>
                </div>
            </div>
            
            <div class="footer-links">
                <a href="#" class="footer-link" onclick="scrollToTop()">
                    <i class="fas fa-arrow-up"></i> Về đầu trang
                </a>
                <a href="#" class="footer-link" onclick="showAbout()">
                    <i class="fas fa-info-circle"></i> Giới thiệu
                </a>
                <a href="#" class="footer-link" onclick="showContact()">
                    <i class="fas fa-envelope"></i> Liên hệ
                </a>
            </div>
            
            <div class="footer-info">
                <div class="copyright">
                    © COPYRIGHT Hoàng Nguyễn
                </div>
            </div>
        </div>
    </footer>

    <div class="control-buttons">
        <button id="music-toggle" class="control-btn" title="Bật/Tắt nhạc"><i class="fas fa-music"></i></button>
        <button id="change-bg" class="control-btn" title="Đổi ảnh nền"><i class="fas fa-image"></i></button>
        <button id="refresh-btn" class="control-btn" title="Làm mới"><i class="fas fa-sync-alt"></i></button>
    </div>

    <audio id="background-music" loop>
        <source src="assets/background-music.mp3" type="audio/mpeg">
    </audio>

    <div class="confirmation-modal" id="confirmation-modal">
        <div class="modal-content">
            <h3>Gửi lời chúc thành công!</h3>
            <p>Lời chúc của bạn đã được gửi đi và mọi người có thể xem được.</p>
            <div class="modal-buttons">
                <button id="close-modal">Đóng</button>
                <button id="share-modal">Chia sẻ</button>
            </div>
        </div>
    </div>

    <script>
        // ========== CẤU HÌNH ==========
        const CONFIG = {
            MAX_WISHES: 50,
            REFRESH_INTERVAL: 30000, // 30 giây
            BACKGROUND_MUSIC_VOLUME: 0.3 ,
            CACHE_EXPIRY: 5 * 60 * 1000 // 5 phút cache
        };
        
        // ========== QUẢN LÝ DỮ LIỆU ==========
        class WishesManager {
            constructor() {
                this.wishes = [];
                this.lastUpdate = 0;
                this.isLoading = false;
            }
            
            // Tải lời chúc từ server
            async loadWishes() {
                if (this.isLoading) return this.wishes;
                
                const now = Date.now();
                if (this.wishes.length > 0 && (now - this.lastUpdate) < CONFIG.CACHE_EXPIRY) {
                    return this.wishes;
                }
                
                this.isLoading = true;
                
                try {
                    const response = await fetch('/api/wishes?t=' + now);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    this.wishes = Array.isArray(data) ? data : [];
                    this.wishes.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                    this.lastUpdate = now;
                    
                    console.log(`Đã tải ${this.wishes.length} lời chúc`);
                } catch (error) {
                    console.error('Lỗi khi tải lời chúc:', error);
                    if (this.wishes.length === 0) {
                        this.wishes = this.getDefaultWishes();
                        console.log('Sử dụng dữ liệu mẫu do lỗi tải file');
                    }
                } finally {
                    this.isLoading = false;
                }
                
                return this.wishes;
            }
            
            // Lưu lời chúc mới
            async saveWish(wishData) {
                const newWish = {
                    id: Date.now().toString(),
                    name: wishData.name.trim(),
                    message: wishData.message.trim(),
                    type: wishData.type,
                    timestamp: Date.now()
                };
                
                try {
                    const savedWish = await this.sendToServer(newWish);
                    this.wishes.unshift(savedWish);
                    
                    // Giới hạn số lượng
                    if (this.wishes.length > CONFIG.MAX_WISHES) {
                        this.wishes = this.wishes.slice(0, CONFIG.MAX_WISHES);
                    }
                    
                    console.log('Lời chúc đã được lưu thành công');
                    return savedWish;
                } catch (error) {
                    console.error('Lỗi khi lưu lời chúc:', error);
                    throw error;
                }
            }
            
            // Gửi dữ liệu đến server
            async sendToServer(wishData) {
                const response = await fetch('/api/wishes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(wishData)
                });
                
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                
                return await response.json();
            }
            
            // Lấy dữ liệu mẫu
            getDefaultWishes() {
                return [
                    {
                        id: "sample1",
                        name: "Huy Hoàng",
                        message: "Chúc cả lớp luôn vui vẻ, hạnh phúc và thành công trong mọi việc! 💖",
                        type: "general",
                        timestamp: Date.now() - 3600000
                    }
                ];
            }
            
            // Validate dữ liệu
            validateWish(wishData) {
                const errors = [];
                
                if (!wishData.name || wishData.name.trim().length < 2) {
                    errors.push('Tên phải có ít nhất 2 ký tự');
                }
                
                if (!wishData.message || wishData.message.trim().length < 10) {
                    errors.push('Lời chúc phải có ít nhất 10 ký tự');
                }
                
                if (wishData.name && wishData.name.length > 50) {
                    errors.push('Tên không được quá 50 ký tự');
                }
                
                if (wishData.message && wishData.message.length > 1000) {
                    errors.push('Lời chúc không được quá 1000 ký tự');
                }
                
                return errors;
            }
        }
        
        // ========== KHỞI TẠO ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Khởi tạo manager
            const wishesManager = new WishesManager();
            let currentBg = 0;
            
            // DOM Elements
            const heartsContainer = document.getElementById('hearts-container');
            const musicToggle = document.getElementById('music-toggle');
            const backgroundMusic = document.getElementById('background-music');
            const changeBgBtn = document.getElementById('change-bg');
            const refreshBtn = document.getElementById('refresh-btn');
            const submitBtn = document.getElementById('submit-btn');
            const confirmationModal = document.getElementById('confirmation-modal');
            const closeModalBtn = document.getElementById('close-modal');
            const shareModalBtn = document.getElementById('share-modal');
            const wishesListElement = document.getElementById('wishes-list');
            const totalWishesElement = document.getElementById('total-wishes');
            
            // ========== XỬ LÝ SỰ KIỆN ==========
            
            // Tải và hiển thị lời chúc ban đầu
            loadAndDisplayWishes();
            
            // Thiết lập làm mới tự động
            setInterval(loadAndDisplayWishes, CONFIG.REFRESH_INTERVAL);
            
            // Bật/tắt nhạc nền
            musicToggle.addEventListener('click', function() {
                if (backgroundMusic.paused) {
                    backgroundMusic.volume = CONFIG.BACKGROUND_MUSIC_VOLUME;
                    backgroundMusic.play();
                    musicToggle.innerHTML = '<i class="fas fa-music"></i>';
                    musicToggle.title = 'Tắt nhạc';
                } else {
                    backgroundMusic.pause();
                    musicToggle.innerHTML = '<i class="fas fa-music-slash"></i>';
                    musicToggle.title = 'Bật nhạc';
                }
            });
            
            // Đổi hình nền
            changeBgBtn.addEventListener('click', function() {
                const bgGradients = [
                    'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)',
                    'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)',
                    'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
                    'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)',
                    'linear-gradient(135deg, #a6c1ee 0%, #fbc2eb 100%)'
                ];
                
                currentBg = (currentBg + 1) % bgGradients.length;
                document.body.style.background = bgGradients[currentBg];
            });
            
            // Làm mới lời chúc
            refreshBtn.addEventListener('click', function() {
                loadAndDisplayWishes();
                createHearts(5); // Hiệu ứng trái tim khi làm mới
            });
            
            // Gửi lời chúc
            submitBtn.addEventListener('click', async function() {
                const name = document.getElementById('name').value;
                const type = document.getElementById('type').value;
                const message = document.getElementById('message').value;
                
                const wishData = { name, type, message };
                const errors = wishesManager.validateWish(wishData);
                
                if (errors.length > 0) {
                    alert('Lỗi:\n' + errors.join('\n'));
                    return;
                }
                
                // Hiển thị loading
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="loading"></span> Đang gửi...';
                
                try {
                    const newWish = await wishesManager.saveWish(wishData);
                    
                    // Hiển thị modal xác nhận
                    confirmationModal.classList.add('active');
                    
                    // Reset form
                    document.getElementById('name').value = '';
                    document.getElementById('message').value = '';
                    
                    // Tải lại danh sách
                    await loadAndDisplayWishes();
                    
                    // Hiệu ứng trái tim
                    createHearts(10);
                } catch (error) {
                    console.error('Lỗi khi gửi lời chúc:', error);
                    alert('Có lỗi xảy ra khi gửi lời chúc. Vui lòng thử lại!');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-heart"></i> Gửi Lời Chúc';
                }
            });
            
            // Đóng modal
            closeModalBtn.addEventListener('click', function() {
                confirmationModal.classList.remove('active');
            });
            
            // Chia sẻ
            shareModalBtn.addEventListener('click', function() {
                if (navigator.share) {
                    navigator.share({
                        title: 'Lời chúc từ LOVE 12A1',
                        text: 'Tôi vừa gửi lời chúc trên LOVE 12A1. Hãy cùng xem nhé!',
                        url: window.location.href
                    }).catch(err => {
                        console.log('Lỗi khi chia sẻ:', err);
                        copyToClipboard(window.location.href);
                        alert('Đã sao chép link vào clipboard!');
                    });
                } else {
                    copyToClipboard(window.location.href);
                    alert('Đã sao chép link vào clipboard!');
                }
            });
            
            // ========== HÀM TIỆN ÍCH ==========
            
            // Tải và hiển thị lời chúc
            async function loadAndDisplayWishes() {
                try {
                    const wishes = await wishesManager.loadWishes();
                    displayWishes(wishes);
                    updateStats(wishes.length);
                } catch (error) {
                    console.error('Lỗi khi tải lời chúc:', error);
                    wishesListElement.innerHTML = '<div class="error-message">Không thể tải lời chúc. Vui lòng thử lại sau!</div>';
                }
            }
            
            // Hiển thị lời chúc
            function displayWishes(wishes) {
                if (!wishes || wishes.length === 0) {
                    wishesListElement.innerHTML = '<div class="empty-message">Chưa có lời chúc nào. Hãy là người đầu tiên!</div>';
                    return;
                }
                
                let html = '';
                
                wishes.forEach(wish => {
                    const typeText = getTypeText(wish.type);
                    const date = new Date(wish.timestamp).toLocaleString();
                    
                    html += `
                        <div class="wish-card">
                            <span class="wish-type">${typeText}</span>
                            <h4>${escapeHtml(wish.name)}</h4>
                            <p>${escapeHtml(wish.message).replace(/\n/g, '<br>')}</p>
                            <small>${date}</small>
                        </div>
                    `;
                });
                
                wishesListElement.innerHTML = html;
            }
            
            // Cập nhật thống kê
            function updateStats(count) {
                totalWishesElement.textContent = count;
            }
            
            // Tạo hiệu ứng trái tim bay
            function createHearts(count) {
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.className = 'heart-float';
                        heart.innerHTML = '❤️';
                        
                        // Random position and animation
                        heart.style.left = `${Math.random() * 100}%`;
                        heart.style.animationDuration = `${4 + Math.random() * 6}s`;
                        heart.style.fontSize = `${1 + Math.random() * 2}rem`;
                        
                        heartsContainer.appendChild(heart);
                        
                        // Remove after animation
                        setTimeout(() => {
                            heart.remove();
                        }, 10000);
                    }, i * 300);
                }
            }
            
            // Lấy tên loại lời chúc
            function getTypeText(type) {
                const types = {
                    'general': 'Lời chúc chung',
                    'love': 'Tình yêu',
                    'friendship': 'Tình bạn',
                    'encouragement': 'Động viên',
                    'memory': 'Kỷ niệm'
                };
                return types[type] || type;
            }
            
            // Escape HTML để phòng XSS
            function escapeHtml(unsafe) {
                if (!unsafe) return '';
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
            
            // Sao chép vào clipboard
            function copyToClipboard(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }
            
            // Cuộn lên đầu trang
            window.scrollToTop = function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            // Hiển thị thông tin giới thiệu
            window.showAbout = function() {
                alert('Trang web được tạo ra để lưu giữ lại những tình cảm, những lời chúc yêu thương của tập thể lớp 12A1');
            };
            
            // Hiển thị thông tin liên hệ
            window.showContact = function() {
                alert('Liên hệ admin qua email: nvhuyhoang24107@gmail.com\nHoặc qua fanpage: fb.com/Phoenix.2417');
            };
            
            // Tự động tạo một vài trái tim khi trang load
            setTimeout(() => createHearts(3), 1000);
            
            // Tạo trái tim ngẫu nhiên mỗi 15 giây
            setInterval(() => {
                if (Math.random() < 0.3) { // 30% chance
                    createHearts(1);
                }
            }, 15000);
            
            // Xử lý form submission với Enter
            document.getElementById('message').addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    submitBtn.click();
                }
            });
            
            // Tự động resize textarea theo nội dung
            document.getElementById('message').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Lazy loading cho lời chúc (intersection observer)
            const observerOptions = {
                root: null,
                rootMargin: '10px',
                threshold: 0.1
            };
            
            const wishObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);
            
            // Animate new wishes when they appear
            function animateNewWishes() {
                const wishCards = document.querySelectorAll('.wish-card');
                wishCards.forEach((card, index) => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 100);
                    
                    wishObserver.observe(card);
                });
            }
            
            // Override displayWishes to include animation
            const originalDisplayWishes = displayWishes;
            displayWishes = function(wishes) {
                originalDisplayWishes(wishes);
                setTimeout(animateNewWishes, 100);
            };
            
            // Thêm easter egg - double click vào tiêu đề
            document.querySelector('h1').addEventListener('dblclick', function() {
                createHearts(20);
                this.style.animation = 'pulse 0.5s ease-in-out 3';
                setTimeout(() => {
                    this.style.animation = 'pulse 2s infinite';
                }, 1500);
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + R: Refresh wishes
                if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                    e.preventDefault();
                    refreshBtn.click();
                }
                
                // Escape: Close modal
                if (e.key === 'Escape') {
                    confirmationModal.classList.remove('active');
                }
                
                // Space: Toggle music (when not typing)
                if (e.key === ' ' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                    e.preventDefault();
                    musicToggle.click();
                }
            });
            
            // Progressive Web App support
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/sw.js')
                        .then(function(registration) {
                            console.log('ServiceWorker registration successful');
                        })
                        .catch(function(err) {
                            console.log('ServiceWorker registration failed: ', err);
                        });
                });
            }
            
            // Handle online/offline status
            window.addEventListener('online', function() {
                console.log('Đã kết nối internet');
                loadAndDisplayWishes();
            });
            
            window.addEventListener('offline', function() {
                console.log('Mất kết nối internet');
            });
            
            // Auto-save draft in localStorage (if available)
            const nameInput = document.getElementById('name');
            const messageInput = document.getElementById('message');
            
            function saveDraft() {
                if (typeof Storage !== 'undefined') {
                    const draft = {
                        name: nameInput.value,
                        message: messageInput.value,
                        timestamp: Date.now()
                    };
                    localStorage.setItem('love12a1_draft', JSON.stringify(draft));
                }
            }
            
            function loadDraft() {
                if (typeof Storage !== 'undefined') {
                    const draftStr = localStorage.getItem('love12a1_draft');
                    if (draftStr) {
                        try {
                            const draft = JSON.parse(draftStr);
                            // Only load draft if it's less than 1 hour old
                            if (Date.now() - draft.timestamp < 3600000) {
                                nameInput.value = draft.name || '';
                                messageInput.value = draft.message || '';
                            } else {
                                localStorage.removeItem('love12a1_draft');
                            }
                        } catch (e) {
                            localStorage.removeItem('love12a1_draft');
                        }
                    }
                }
            }
            
            function clearDraft() {
                if (typeof Storage !== 'undefined') {
                    localStorage.removeItem('love12a1_draft');
                }
            }
            
            // Load draft on page load
            loadDraft();
            
            // Save draft periodically while typing
            let draftTimeout;
            [nameInput, messageInput].forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(draftTimeout);
                    draftTimeout = setTimeout(saveDraft, 1000); // Save after 1 second of no typing
                });
            });
            
            // Clear draft after successful submission
            const originalSaveWish = wishesManager.saveWish;
            wishesManager.saveWish = async function(wishData) {
                const result = await originalSaveWish.call(this, wishData);
                clearDraft();
                return result;
            };
            
            // Notification permission (for future features)
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    Notification.requestPermission().then(permission => {
                        console.log('Notification permission:', permission);
                    });
                }, 5000); // Ask after 5 seconds
            }
            
            // Touch gestures for mobile
            let touchStartY = 0;
            let touchEndY = 0;
            
            document.addEventListener('touchstart', function(e) {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                touchEndY = e.changedTouches[0].clientY;
                handleSwipe();
            }, { passive: true });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchStartY - touchEndY;
                
                // Swipe up to refresh
                if (diff > swipeThreshold && window.scrollY === 0) {
                    refreshBtn.click();
                }
            }
            
            // Performance monitoring
            if ('performance' in window) {
                window.addEventListener('load', function() {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart, 'ms');
                    }, 0);
                });
            }
            
            // Error handling for unhandled errors
            window.addEventListener('error', function(e) {
                console.error('Global error:', e.error);
                // Could send to analytics service in production
            });
            
            window.addEventListener('unhandledrejection', function(e) {
                console.error('Unhandled promise rejection:', e.reason);
                // Could send to analytics service in production
            });
            
            console.log('LOVE 12A1 initialized successfully! 💖');
        });
    </script>
</body>
</html>
